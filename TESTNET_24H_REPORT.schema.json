{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Testnet 24h Validation Report Schema",
  "description": "Data structure for collecting 24-hour testnet trading validation metrics and incidents",
  "type": "object",
  "required": [
    "metadata",
    "environment",
    "routes",
    "statistics",
    "latency",
    "reliability",
    "risk",
    "incidents"
  ],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Report metadata and identifiers",
      "required": ["report_id", "timestamp_start", "timestamp_end", "duration_hours"],
      "properties": {
        "report_id": {
          "type": "string",
          "description": "Unique report ID (format: 'testnet-24h-{date}-{random}' e.g. 'testnet-24h-2025-01-26-a7f3')",
          "pattern": "^testnet-24h-\\d{4}-\\d{2}-\\d{2}-[a-f0-9]{4}$"
        },
        "timestamp_start": {
          "type": "string",
          "format": "date-time",
          "description": "Report start time (ISO 8601 UTC)"
        },
        "timestamp_end": {
          "type": "string",
          "format": "date-time",
          "description": "Report end time (ISO 8601 UTC)"
        },
        "duration_hours": {
          "type": "number",
          "minimum": 23,
          "maximum": 25,
          "description": "Report duration in hours (expected: ~24)"
        },
        "test_seed": {
          "type": "integer",
          "description": "Random seed used for backtester reproducibility",
          "minimum": 1000,
          "maximum": 999999
        },
        "team": {
          "type": "string",
          "description": "Team/engineer executing test"
        },
        "approval_status": {
          "type": "string",
          "enum": ["PENDING", "APPROVED", "REJECTED", "PENDING_REVIEW"],
          "description": "Go/no-go approval status"
        }
      }
    },
    "environment": {
      "type": "object",
      "description": "Environment and version information",
      "required": ["exchange", "mode", "testnet", "versions"],
      "properties": {
        "exchange": {
          "type": "string",
          "enum": ["binance"],
          "description": "Cryptocurrency exchange"
        },
        "mode": {
          "type": "string",
          "enum": ["testnet", "paper", "backtest"],
          "description": "Trading mode for this test"
        },
        "testnet": {
          "type": "boolean",
          "description": "Whether testnet mode is enabled (should be true for this report)"
        },
        "versions": {
          "type": "object",
          "required": ["yunmin", "binance_connector", "trading_engine"],
          "properties": {
            "yunmin": {
              "type": "string",
              "description": "YunMin system version (e.g. '2.1.0')"
            },
            "binance_connector": {
              "type": "string",
              "description": "BinanceConnector version"
            },
            "trading_engine": {
              "type": "string",
              "description": "TradingEngine version"
            },
            "backtester": {
              "type": "string",
              "description": "Backtester version"
            },
            "python": {
              "type": "string",
              "description": "Python version (e.g. '3.13.0')"
            }
          }
        },
        "config_hash": {
          "type": "string",
          "description": "SHA256 hash of locked configuration file",
          "pattern": "^[a-f0-9]{64}$"
        }
      }
    },
    "routes": {
      "type": "array",
      "description": "Trading routes/symbols tested",
      "minItems": 1,
      "maxItems": 10,
      "items": {
        "type": "object",
        "required": ["symbol", "timeframe", "trades_count"],
        "properties": {
          "symbol": {
            "type": "string",
            "description": "Trading pair (e.g. 'BTCUSDT')",
            "pattern": "^[A-Z0-9]+$"
          },
          "timeframe": {
            "type": "string",
            "enum": ["1m", "5m", "15m", "1h", "4h", "1d"],
            "description": "Candle timeframe for this route"
          },
          "trades_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of trades executed on this route"
          },
          "fills_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of successful fills"
          },
          "rejects_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of rejected orders"
          }
        }
      }
    },
    "statistics": {
      "type": "object",
      "description": "Trading performance statistics",
      "required": [
        "starting_balance",
        "ending_balance",
        "total_pnl",
        "pnl_percent",
        "max_drawdown",
        "total_trades",
        "winning_trades",
        "losing_trades",
        "win_rate",
        "profit_factor",
        "avg_fill_rate"
      ],
      "properties": {
        "starting_balance": {
          "type": "number",
          "minimum": 0,
          "description": "Initial account balance (USDT)"
        },
        "ending_balance": {
          "type": "number",
          "minimum": 0,
          "description": "Final account balance (USDT)"
        },
        "total_pnl": {
          "type": "number",
          "description": "Total profit/loss (USDT)"
        },
        "pnl_percent": {
          "type": "number",
          "description": "P&L as percentage of starting balance"
        },
        "max_drawdown": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Maximum drawdown as fraction (0.05 = 5%)"
        },
        "total_trades": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of trades executed"
        },
        "winning_trades": {
          "type": "integer",
          "minimum": 0,
          "description": "Trades with positive P&L"
        },
        "losing_trades": {
          "type": "integer",
          "minimum": 0,
          "description": "Trades with negative P&L"
        },
        "win_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Winning trades / total trades"
        },
        "profit_factor": {
          "type": "number",
          "minimum": 0,
          "description": "Gross profit / gross loss"
        },
        "avg_fill_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Successful fills / total orders"
        },
        "sharpe_ratio": {
          "type": "number",
          "description": "Risk-adjusted return metric"
        },
        "sortino_ratio": {
          "type": "number",
          "description": "Downside risk-adjusted return"
        },
        "calmar_ratio": {
          "type": "number",
          "description": "Return / max drawdown"
        },
        "total_fees": {
          "type": "number",
          "minimum": 0,
          "description": "Total trading fees (USDT)"
        },
        "avg_commission_bps": {
          "type": "number",
          "minimum": 0,
          "description": "Average commission per trade (basis points)"
        }
      }
    },
    "latency": {
      "type": "object",
      "description": "Network latency measurements",
      "required": [
        "ws_latency_p50_ms",
        "ws_latency_p95_ms",
        "ws_latency_p99_ms",
        "rest_latency_p50_ms",
        "rest_latency_p95_ms",
        "rest_latency_p99_ms"
      ],
      "properties": {
        "ws_latency_p50_ms": {
          "type": "number",
          "minimum": 0,
          "description": "WebSocket latency 50th percentile (ms)"
        },
        "ws_latency_p95_ms": {
          "type": "number",
          "minimum": 0,
          "description": "WebSocket latency 95th percentile (ms)"
        },
        "ws_latency_p99_ms": {
          "type": "number",
          "minimum": 0,
          "description": "WebSocket latency 99th percentile (ms)"
        },
        "ws_latency_max_ms": {
          "type": "number",
          "minimum": 0,
          "description": "WebSocket maximum latency observed (ms)"
        },
        "rest_latency_p50_ms": {
          "type": "number",
          "minimum": 0,
          "description": "REST API latency 50th percentile (ms)"
        },
        "rest_latency_p95_ms": {
          "type": "number",
          "minimum": 0,
          "description": "REST API latency 95th percentile (ms)"
        },
        "rest_latency_p99_ms": {
          "type": "number",
          "minimum": 0,
          "description": "REST API latency 99th percentile (ms)"
        },
        "rest_latency_max_ms": {
          "type": "number",
          "minimum": 0,
          "description": "REST API maximum latency observed (ms)"
        },
        "order_execution_latency_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Average time from order decision to fill"
        }
      }
    },
    "reliability": {
      "type": "object",
      "description": "System reliability and error rates",
      "required": [
        "ws_uptime_percent",
        "ws_reconnect_count",
        "ws_reconnect_total_downtime_s",
        "rest_request_count",
        "rest_error_count",
        "rest_timeout_count",
        "order_reject_count",
        "stuck_order_count",
        "data_sync_mismatches"
      ],
      "properties": {
        "ws_uptime_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "WebSocket connection uptime (%)"
        },
        "ws_reconnect_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of WebSocket reconnection events"
        },
        "ws_reconnect_total_downtime_s": {
          "type": "number",
          "minimum": 0,
          "description": "Total downtime during reconnects (seconds)"
        },
        "ws_reconnect_avg_duration_s": {
          "type": "number",
          "minimum": 0,
          "description": "Average reconnection duration (seconds)"
        },
        "rest_request_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total REST API requests made"
        },
        "rest_error_count": {
          "type": "integer",
          "minimum": 0,
          "description": "REST API 4xx/5xx errors"
        },
        "rest_timeout_count": {
          "type": "integer",
          "minimum": 0,
          "description": "REST API timeout errors"
        },
        "rest_error_rate_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "REST error rate (%)"
        },
        "order_reject_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Orders rejected by exchange"
        },
        "order_reject_reasons": {
          "type": "object",
          "description": "Breakdown of rejection reasons",
          "properties": {
            "insufficient_balance": { "type": "integer" },
            "invalid_price": { "type": "integer" },
            "duplicate_order": { "type": "integer" },
            "other": { "type": "integer" }
          }
        },
        "stuck_order_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Orders that didn't fill within timeout"
        },
        "data_sync_mismatches": {
          "type": "integer",
          "minimum": 0,
          "description": "Position sync mismatches vs Binance"
        },
        "partial_fill_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Orders with partial fills"
        }
      }
    },
    "risk": {
      "type": "object",
      "description": "Risk management validation",
      "required": [
        "risk_violations",
        "kill_switch_triggered",
        "position_limit_breaches",
        "daily_dd_limit_breaches"
      ],
      "properties": {
        "risk_violations": {
          "type": "array",
          "description": "List of risk rule violations",
          "items": {
            "type": "object",
            "required": ["timestamp", "rule", "value", "limit", "action"],
            "properties": {
              "timestamp": {
                "type": "string",
                "format": "date-time",
                "description": "When violation occurred"
              },
              "rule": {
                "type": "string",
                "enum": [
                  "max_position_size",
                  "daily_trade_limit",
                  "open_order_limit",
                  "daily_drawdown",
                  "margin_ratio"
                ],
                "description": "Which risk rule was violated"
              },
              "value": {
                "type": "number",
                "description": "Actual value that violated limit"
              },
              "limit": {
                "type": "number",
                "description": "Risk limit threshold"
              },
              "action": {
                "type": "string",
                "enum": ["REJECTED", "KILLED", "WARNED", "LOGGED"],
                "description": "Action taken by risk manager"
              }
            }
          }
        },
        "kill_switch_triggered": {
          "type": "boolean",
          "description": "Whether kill-switch was activated during test"
        },
        "kill_switch_triggers": {
          "type": "array",
          "description": "List of events that would trigger kill-switch",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": { "type": "string", "format": "date-time" },
              "event": { "type": "string" },
              "action": { "type": "string" }
            }
          }
        },
        "position_limit_breaches": {
          "type": "integer",
          "minimum": 0,
          "description": "Times position size exceeded limit"
        },
        "daily_dd_limit_breaches": {
          "type": "integer",
          "minimum": 0,
          "description": "Times daily drawdown exceeded limit"
        },
        "max_leverage_used": {
          "type": "number",
          "minimum": 1,
          "description": "Peak leverage ratio during test"
        },
        "margin_utilization_peak": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Peak margin utilization (0.75 = 75%)"
        }
      }
    },
    "incidents": {
      "type": "array",
      "description": "Critical incidents or anomalies",
      "items": {
        "type": "object",
        "required": ["timestamp", "severity", "type", "description", "impact", "resolution"],
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When incident occurred"
          },
          "severity": {
            "type": "string",
            "enum": ["INFO", "WARN", "CRIT"],
            "description": "Incident severity level"
          },
          "type": {
            "type": "string",
            "enum": [
              "api_error",
              "ws_disconnect",
              "latency_spike",
              "order_rejected",
              "partial_fill",
              "data_mismatch",
              "kill_switch",
              "timeout",
              "other"
            ],
            "description": "Incident category"
          },
          "description": {
            "type": "string",
            "description": "Detailed incident description"
          },
          "impact": {
            "type": "string",
            "enum": ["NONE", "MINOR", "MAJOR", "CRITICAL"],
            "description": "Impact on trading"
          },
          "resolution": {
            "type": "string",
            "description": "How incident was resolved"
          },
          "logs_reference": {
            "type": "string",
            "description": "Path to relevant log lines"
          }
        }
      }
    },
    "artifacts": {
      "type": "object",
      "description": "References to supporting files and logs",
      "properties": {
        "logs_path": {
          "type": "string",
          "description": "Path to trading logs directory"
        },
        "report_path": {
          "type": "string",
          "description": "Path to HTML/CSV report files"
        },
        "metrics_export_path": {
          "type": "string",
          "description": "Path to metrics JSON/CSV exports"
        },
        "backtester_seed": {
          "type": "integer",
          "description": "Seed used for reproducible backtesting"
        },
        "config_file_hash": {
          "type": "string",
          "description": "SHA256 of locked config file"
        }
      }
    },
    "approval": {
      "type": "object",
      "description": "Approval and sign-off",
      "required": ["go_no_go_decision", "reviewer_name", "review_date"],
      "properties": {
        "go_no_go_decision": {
          "type": "string",
          "enum": ["GO", "NO_GO", "GO_WITH_CAVEATS"],
          "description": "Final go/no-go decision for live trading"
        },
        "go_no_go_rationale": {
          "type": "string",
          "description": "Rationale for go/no-go decision"
        },
        "reviewer_name": {
          "type": "string",
          "description": "Name of approving engineer/trader"
        },
        "review_date": {
          "type": "string",
          "format": "date-time",
          "description": "Date of review/approval"
        },
        "sign_off_version": {
          "type": "string",
          "description": "Git commit/tag of reviewed code"
        },
        "caveats": {
          "type": "array",
          "description": "Conditions or caveats for approval",
          "items": { "type": "string" }
        }
      }
    }
  }
}
