# Yun Min Trading Agent Configuration
# This is the default configuration file. Override with environment variables.

# Exchange Configuration
exchange:
  name: binance
  testnet: true  # ALWAYS start with testnet!
  enable_rate_limit: true

# Trading Configuration
trading:
  mode: dry_run  # Options: dry_run, paper, live
  symbol: BTC/USDT
  timeframe: 5m
  initial_capital: 15000.0  # Increased for 3 symbols ($5k each)
  
  # Multi-Symbol Configuration
  symbols:
    - symbol: BTC/USDT
      allocation: 0.4  # 40% of capital
      risk_limit: 0.02  # 2% max position size (aligned with risk.max_position_size)
    - symbol: ETH/USDT
      allocation: 0.35  # 35% of capital
      risk_limit: 0.02  # 2% max position size
    - symbol: BNB/USDT
      allocation: 0.25  # 25% of capital
      risk_limit: 0.02  # 2% max position size
  
  portfolio:
    total_capital: 10000
    max_total_exposure: 0.15  # Max 15% in positions (aligned with risk.max_total_exposure)
    rebalance_threshold: 0.10  # Rebalance if drift >10%

# Risk Management (CRITICAL - DO NOT DISABLE)
# UPDATED: Reduced risk parameters based on security audit (Nov 2025)
# Previous: 8% position × 2x leverage = 16% exposure (TOO HIGH)
# Current: 2% position × 3x leverage = 6% exposure per trade (SAFE)
risk:
  max_position_size: 0.02  # 2% of capital per position (was 8% - CRITICAL FIX)
  max_leverage: 3.0  # 3x leverage for controlled risk (was 2.0x)
  max_total_exposure: 0.15  # Maximum 15% of capital in ALL positions combined
  max_daily_drawdown: 0.04  # 4% max daily loss (tighter)
  stop_loss_pct: 0.02  # 2% stop loss (tighter protection)
  take_profit_pct: 0.05  # 5% take profit (better R/R ratio: 2.5:1)
  enable_circuit_breaker: true
  
  # Margin safety thresholds
  min_margin_level: 200  # Close positions if margin level < 200%
  critical_margin_level: 150  # Emergency exit if < 150%
  
  # Funding rate limits (for futures)
  max_funding_rate: 0.001  # Avoid positions with funding > 0.1%

# Strategy Configuration
# UPDATED: More conservative entry conditions based on security audit (Nov 2025)
# PHASE 2.1: Relaxed thresholds for increased trading frequency (4% → 15-20%)
# PHASE 2.2: Hybrid mode - classical analysis + AI confirmation
# PHASE 2.3: Advanced indicators for better signal quality
strategy:
  name: ema_crossover
  fast_ema: 12  # Optimized for 5m timeframe
  slow_ema: 26  # Better signal quality
  rsi_period: 14
  rsi_overbought: 70.0  # OPTIMIZED: Grid search best result (was 65)
  rsi_oversold: 30.0    # OPTIMIZED: Grid search best result (was 35)
  
  # Additional filters for entry confirmation
  # PHASE 2.1: Relaxed filters for increased trading frequency
  volume_multiplier: 1.2  # Relaxed from 1.5 to 1.2 (easier volume threshold)
  require_ema_crossover: true  # Require EMA confirmation
  require_divergence: false  # Divergence detection (experimental)
  min_ema_distance: 0.003  # Relaxed from 0.5% to 0.3% distance between EMAs
  
  # PHASE 2.2: Hybrid mode configuration
  hybrid_mode: true  # Use classical analysis + AI confirmation
  classical_confidence_threshold: 0.70  # If classical >= 70%, skip AI
  
  # PHASE 2.3: Advanced indicators
  use_advanced_indicators: true  # Enable MACD, Bollinger Bands, ATR, OBV, Ichimoku
  
  # Advanced indicator parameters
  macd_fast: 12
  macd_slow: 26
  macd_signal: 9
  bollinger_period: 20
  bollinger_std: 2.0
  atr_period: 14
  ichimoku_tenkan: 9
  ichimoku_kijun: 26
  ichimoku_senkou_b: 52

# Machine Learning
ml:
  enabled: false  # Enable after testing rule-based strategy
  model_type: xgboost
  retrain_interval: 86400  # 24 hours
  feature_lookback: 100

# Backtesting Configuration
backtest:
  initial_capital: 100000.0
  position_size_pct: 0.01  # 1% of capital per trade
  leverage: 1.0  # 1x leverage (no leverage)
  maker_fee: 0.0002  # 0.02% maker fee
  taker_fee: 0.0004  # 0.04% taker fee
  slippage: 0.0002  # 0.02% slippage
  stop_loss_pct: 0.02  # 2% stop loss
  take_profit_pct: 0.05  # 5% take profit
  
  # Trade frequency controls (Issue #39)
  cooldown_bars: 5  # Minimum bars between trades
  confirmation_bars: 2  # Bars to confirm signal
  min_holding_bars: 10  # Minimum bars to hold position

# Optimizer Configuration (Issue #40)
optimizer:
  # Grid search parameters
  grid_search:
    max_combinations: 100  # Limit grid search combinations
  
  # Random search parameters  
  random_search:
    n_iterations: 50  # Number of random samples
  
  # Walk-forward validation parameters
  walk_forward:
    train_size: 1000  # Training window size (bars)
    test_size: 200  # Testing window size (bars)
    n_splits: 5  # Number of walk-forward splits
  
  # Optimization metrics
  metrics:
    primary: sharpe_ratio  # Primary optimization metric
    secondary:
      - total_pnl
      - win_rate
      - max_drawdown

# LLM Integration - OPENAI GPT-4O-MINI (RECOMMENDED)
llm:
  enabled: true
  provider: openai  # openai | groq | grok
  model: gpt-4o-mini  # OpenAI: gpt-4o-mini (recommended), gpt-4o, gpt-4-turbo
                      # Groq: llama-3.3-70b-versatile, mixtral-8x7b-32768
  # API key loaded from environment variable:
  # - OPENAI_API_KEY for OpenAI models
  # - GROK_API_KEY or GROQ_API_KEY for Groq/Grok models
  fallback_model: gpt-4o  # Fallback to paid model if needed
  max_daily_tokens_gpt5: 250000  # 250k tokens/day FREE (GPT-4o)
  max_daily_tokens_mini: 2500000  # 2.5M tokens/day FREE (GPT-4o-mini)
  explain_trades: true
  
  # Provider-specific notes:
  # OpenAI: Best quality, free tier available, fast responses
  # Groq: Fast inference, free tier, good for high-frequency analysis
  # Note: Groq and Grok refer to the same provider (xAI/Groq)

# Database
database:
  db_url: sqlite:///data/yunmin.db
  redis_url: redis://localhost:6379/0

# Notifications - Telegram Bot for Real-time Alerts
telegram:
  enabled: false  # Set to true after setup
  bot_token: "YOUR_BOT_TOKEN_HERE"  # Get from @BotFather
  chat_id: "YOUR_CHAT_ID_HERE"      # Get from @userinfobot
  
  # Alert settings
  alerts:
    trade_execution: true      # Alert on every trade
    daily_summary: true        # Send daily report (8am, 8pm)
    critical_only: false       # Only send critical alerts
    
    # Thresholds
    drawdown_threshold: 10.0   # Alert if drawdown > 10%
    error_alerts: true         # Alert on errors
    
    # Bot lifecycle
    startup_alert: true        # Alert when bot starts
    shutdown_alert: true       # Alert when bot stops

# Legacy notification config (deprecated)
notification:
  telegram_enabled: false

# General
log_level: INFO
data_dir: ./data
